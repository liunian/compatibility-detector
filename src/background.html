<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Chrome Compatibility Detector</title>
</head>
<body>
<script>
/**
 * Change BrowserAction's status.
 * Status: [normal | warning]
 */
const ICON_PATH = {
  'normal': 'icon_normal.png',
  'warning': 'icon_warning.png'
};
function setBrowserAction(status, tabId) {
  chrome.browserAction.setIcon({
    path: ICON_PATH[status],
    tabId: tabId
  });
  chrome.browserAction.setTitle({
    title: chrome.i18n.getMessage(status + 'TitleText'),
    tabId: tabId
  });
}

// Each page's information.
var detections = { };

// Change status when tab loaded or refreshed.
chrome.tabs.onUpdated.addListener(function(tabId, changeInfo, tab) {
  if (changeInfo.status == 'loading') {
    delete detections[tabId];
    setBrowserAction('normal', tabId);
  }
});

// Delete tab's information when tab closed.
chrome.tabs.onRemoved.addListener(function(tabId) {
  delete detections[tabId];
});
</script>
</body>
</html>
